<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>New York Times Headline</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">    
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-3">New York Times Headlines</h1>
            <p class="lead">Make your selections</p>
            <hr>
            <form role="form">
                <div class="row">
                    <div class='col-sm-3'>
                        <div class="col">
                            <label>Start Range</label>
                            <input id="startYear" type="text" value="1963" class="form-control form-control-sm"/> 
                        </div>
                        <div class="col">
                            <label>End Range</label>
                            <input id="endYear" type="text" value="1982" class="form-control form-control-sm"/> 
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label>Number of storie</label>
                        <div class="dropdown">
                            <button id="numStories" class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Number of stories
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" value="1">One</a>
                                <a class="dropdown-item" value="5">Five</a>
                                <a class="dropdown-item" value="10">Ten</a>
                            </div>
                        </div>               
                    </div>
                    <div class="col-sm-3">
                        <label>Search Term</label>
                        <input type="text" class="form-control form-control-sm" id="searchTerm">
                    </div>
                </div>
            </form>
            <hr>
            <div class="row">
                <div class="col">
                        <button type="submit" class="btn btn-default" id="search">Search</button>
                        <button class="btn btn-default" id="clear">Clear</button>            
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <!-- this is a sample headline output for css -->
            <div class="card">
                <!-- card Heading for the retrieved articles box -->
                <div class="cardHeadlines">
                    <strong>Top Articles</strong>
                </div>
                <!-- This main card will hold each of the resulting articles -->
                <div class="card-body" id="articleSection">
                </div>
            </div>
        </div>
    </div>

    <!-- Latest compiled and minified JavaScript 
         Needs to be above our script below so it loads first -->
         <script src="https://code.jquery.com/jquery.js"></script>
         <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
         <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
         

    <!--  our script .. would be moved to separate file in production -->
<script>
    /**
    * pulls information from the form and build the query URL
    * @returns {string} URL for NYT API based on form inputs
    */
    function buildQueryURL() {
        // queryURL is the url we'll use to query the API
        var queryURL = "https://api.nytimes.com/svc/search/v2/articlesearch.json?";

        // Begin building an object to contain our API call's query parameters
        // Set the API key
        var queryParams = { "api-key": "b9f91d369ff59547cd47b931d8cbc56b:0:74623931" };

        // Grab text the user typed into the search input, add to the queryParams object
        queryParams.q = $("#searchTerm")
            .val()
            .trim();

        // If the user provides a startYear, include it in the queryParams object
        var startYear = $("#startYear")
            .val()
            .trim();

        if (parseInt(startYear)) {
            queryParams.begin_date = startYear + "0101";
        }

        // If the user provides an endYear, include it in the queryParams object
        var endYear = $("#endYear")
            .val()
            .trim();

        if (parseInt(endYear)) {
            queryParams.end_date = endYear + "0101";
        }

        // Logging the URL so we have access to it for troubleshooting
        console.log("---------------\nURL: " + queryURL + "\n---------------");
        console.log(queryURL + $.param(queryParams));
        return queryURL + $.param(queryParams);
    };
            

    /**
    * takes API data (JSON/object) and turns it into elements on the page
    * @param {object} NYTData - object containing NYT API data
    */
    function updatePage(NYTData) {
        // Get from the form the number of results to display
        // API doesn't have a "limit" parameter, so we have to do this ourselves
        var numArticles = $("#numStories").val();

        // Log the NYTData to console, where it will show up as an object
        console.log(NYTData);
        console.log("------------------------------------");

        // Loop through and build elements for the defined number of articles
        for (var i = 0; i < numArticles; i++) {
            // Get specific article info for current index
            var article = NYTData.response.docs[i];

            // Increase the articleCount (track article # - starting at 1)
            var articleCount = i + 1;

            // Create the  list group to contain the articles and add the article content for each
            var $articleList = $("<ul>");
            $articleList.addClass("list-group");

            // Add the newly created element to the DOM
            $("#articleSection").append($articleList);

            // If the article has a headline, log and append to $articleList
            var headline = article.headline;
            var $articleListItem = $("<li class='list-group-item articleHeadline'>");

            if (headline && headline.main) {
                console.log(headline.main);
                $articleListItem.append(
                    "<span class='label label-primary'>" +
                    articleCount +
                    "</span>" +
                    "<strong> " +
                    headline.main +
                    "</strong>"
                );
            }

            // If the article has a byline, log and append to $articleList
            var byline = article.byline;

            if (byline && byline.original) {
            console.log(byline.original);
            $articleListItem.append("<h5>" + byline.original + "</h5>");
            }

            // Log section, and append to document if exists
            var section = article.section_name;
            console.log(article.section_name);
            if (section) {
            $articleListItem.append("<h5>Section: " + section + "</h5>");
            }

            // Log published date, and append to document if exists
            var pubDate = article.pub_date;
            console.log(article.pub_date);
            if (pubDate) {
            $articleListItem.append("<h5>" + article.pub_date + "</h5>");
            }

            // Append and log url
            $articleListItem.append("<a href='" + article.web_url + "'>" + article.web_url + "</a>");
            console.log(article.web_url);

            // Append the article
            $articleList.append($articleListItem);
        }
    };

    // Function to empty out the articles
    function clear() {
        $("#articleSection").empty();
    }


    // Creating an AJAX call for the specific movie button being clicked
    // .on("click") function associated with the Search Button
    $("#search").on("click", function(event) {

        // This line allows us to take advantage of the HTML "submit" property
        // This way we can hit enter on the keyboard and it registers the search
        // (in addition to clicks). Prevents the page from reloading on form submit.
        event.preventDefault();

        // Empty the region associated with the articles
        clear();

        // Build the query URL for the ajax request to the NYT API
        // This approach separates the clicking and ajax call
        // each click gets the latest values from the querry fields
        var queryURL = buildQueryURL();

        // Make the AJAX request to the API - GETs the JSON data at the queryURL.
        // The data then gets passed as an argument to the updatePage function
        // by calling updatePage here, it's like a call back function.
        // I thimk this is how to get the data out of here and up into
        // other variables. 
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(updatePage);
    });
    </script>


</body>
</html>